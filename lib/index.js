"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_list=require("./list"),_list2=_interopRequireDefault(_list),_contact=require("./contact"),_contact2=_interopRequireDefault(_contact),_customfield=require("./customfield"),_customfield2=_interopRequireDefault(_customfield),_segment=require("./segment"),_segment2=_interopRequireDefault(_segment),_criteria=require("./criteria"),_criteria2=_interopRequireDefault(_criteria),_message=require("./message"),_message2=_interopRequireDefault(_message),_request=require("request"),_request2=_interopRequireDefault(_request),_path=require("path"),_path2=_interopRequireDefault(_path),iContact=function(){function e(t){if(_classCallCheck(this,e),!(this instanceof e))return new e(t);if(!t)throw new Error("Configuration is undefined");this.appId=t.appId||process.env.iContactAppId,this.username=t.username||process.env.iContactUsername,this.password=t.password||process.env.iContactPassword,this.accountId=t.accountId||process.env.iContactAccountId,this.clientFolderId=t.clientFolderId||process.env.iContactClientFolderId,this.headers={Accept:"application/json","Content-Type":"appliiocation/json","Api-Version":"2.0","Api-AppId":this.appId,"Api-Username":this.username,"API-Password":this.password},this.domain="production"==process.env.NODE_ENV?"https://app.icontact.com/":"https://app.sandbox.icontact.com/",this.baseUrl=_path2["default"].join("icp","a",this.accountId.toString(),"c",this.clientFolderId.toString())}return _createClass(e,[{key:"validateArray",value:function(e,t){var r=null;for(var n in e){var i=e[n];if(!i[t]){r=new Error(t+" is required");break}}if(r)throw r;return e}},{key:"process",value:function(e,t,r){if(!(e instanceof Array))throw new Error("Array of path is not provided");t||(t="GET");var n=this.headers,i=_path2["default"].join.apply(null,e);i=this.domain+_path2["default"].join(this.baseUrl,i);var a={url:i,headers:n,method:t,timeout:3e4};return r&&(console.log(r),a.form=r),new Promise(function(e,t){return console.log("sending request to",i),_request2["default"](a,function(r,n,i){return r?t(r):(i=JSON.parse(i),i.errors?t(new Error(i.errors.pop())):i.warnings?t(new Error(i.warnings.pop())):e(i))})})}},{key:"List",value:function(){return new _list2["default"](this)}},{key:"Contact",value:function(){return new _contact2["default"](this)}},{key:"Segment",value:function(){return new _segment2["default"](this)}},{key:"Criteria",value:function(e){if(!e)throw new Error("segmentId is required");return new _criteria2["default"](this,e.toString())}},{key:"CustomField",value:function(){return new _customfield2["default"](this)}},{key:"Message",value:function(){return new _message2["default"](this)}}]),e}();exports["default"]=iContact,module.exports=exports["default"];
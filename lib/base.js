"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_request=require("request"),_request2=_interopRequireDefault(_request),_querystring=require("querystring"),_querystring2=_interopRequireDefault(_querystring),_path=require("path"),_path2=_interopRequireDefault(_path),Base=function(){function e(t,r){if(_classCallCheck(this,e),r||(r=process.env.NODE_ENV||!1),!t)throw new Error("Configuration is required");this.appId=t.appId||process.env.iContactAppId,this.username=t.username||process.env.iContactUsername,this.password=t.password||process.env.iContactPassword,this.accountId=t.accountId||process.env.iContactAccountId,this.clientFolderId=t.clientFolderId||process.env.iContactClientFolderId,this.limit=100,this.offset=0,this.headers={Accept:"application/json","Content-Type":"appliiocation/json","Api-Version":"2.0","Api-AppId":this.appId,"Api-Username":this.username,"API-Password":this.password},this.domain=r?"https://app.icontact.com/":"https://app.sandbox.icontact.com/",this.baseUrl=_path2["default"].join("icp","a",this.accountId.toString(),"c",this.clientFolderId.toString())}return _createClass(e,[{key:"create",value:function(e,t,r){if(!e)throw new Erro("No date provided to create new record");return this.process(t,"POST",[e]).then(function(e){return Promise.resolve(e[r].pop())})}},{key:"read",value:function(e,t,r,n){return this.process(r).then(function(e){return Promise.resolve(e[n])})}},{key:"update",value:function(e,t,r){if(!e)throw new Error("No updated record provided");return this.process(t,"POST",e).then(function(e){return Promise.resolve(e[r])})}},{key:"count",value:function(e){return this.limit=1,this.offset=0,this.process(e).then(function(e){return Promise.resolve(e.total)})}},{key:"process",value:function(e,t,r){if(!(e instanceof Array))throw new Error("Array of path is not provided");t||(t="GET");var n=this.headers,o=_path2["default"].join.apply(null,e);o=this.domain+_path2["default"].join(this.baseUrl,o);var s=_querystring2["default"].stringify({limit:this.limit||100,offset:this.offset||0}),i={url:""+o+"?"+s,headers:n,method:t};return r&&(console.log(r),i.form=r),new Promise(function(e,t){return console.log("sending request to",""+o+"?"+s),_request2["default"](i,function(r,n,o){return r?t(r):(o=JSON.parse(o),o.errors?t(new Error(o.errors.pop())):o.warnings?t(new Error(o.warnings.pop())):e(o))})})}}]),e}();exports["default"]=Base,module.exports=exports["default"];